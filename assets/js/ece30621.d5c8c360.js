"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4077],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=n.createContext({}),u=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(o.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(r),d=a,f=p["".concat(o,".").concat(d)]||p[d]||m[d]||l;return r?n.createElement(f,s(s({ref:t},c),{},{components:r})):n.createElement(f,s({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,s=new Array(l);s[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[p]="string"==typeof e?e:a,s[1]=i;for(var u=2;u<l;u++)s[u]=r[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5162:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(7294),a=r(6010);const l={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:r,className:s}=e;return n.createElement("div",{role:"tabpanel",className:(0,a.Z)(l.tabItem,s),hidden:r},t)}},4866:(e,t,r)=>{r.d(t,{Z:()=>N});var n=r(7462),a=r(7294),l=r(6010),s=r(2466),i=r(6550),o=r(1980),u=r(7392),c=r(12);function p(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:r,attributes:n,default:a}}=e;return{value:t,label:r,attributes:n,default:a}}))}function m(e){const{values:t,children:r}=e;return(0,a.useMemo)((()=>{const e=t??p(r);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function d(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:r}=e;const n=(0,i.k6)(),l=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,o._X)(l),(0,a.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(n.location.search);t.set(l,e),n.replace({...n.location,search:t.toString()})}),[l,n])]}function h(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,l=m(e),[s,i]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:l}))),[o,u]=f({queryString:r,groupId:n}),[p,h]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,l]=(0,c.Nk)(r);return[n,(0,a.useCallback)((e=>{r&&l.set(e)}),[r,l])]}({groupId:n}),b=(()=>{const e=o??p;return d({value:e,tabValues:l})?e:null})();(0,a.useLayoutEffect)((()=>{b&&i(b)}),[b]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!d({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),h(e)}),[u,h,l]),tabValues:l}}var b=r(2389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){let{className:t,block:r,selectedValue:i,selectValue:o,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,s.o5)(),m=e=>{const t=e.currentTarget,r=c.indexOf(t),n=u[r].value;n!==i&&(p(t),o(n))},d=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;t=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;t=c[r]??c[c.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":r},t)},u.map((e=>{let{value:t,label:r,attributes:s}=e;return a.createElement("li",(0,n.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:d,onClick:m},s,{className:(0,l.Z)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":i===t})}),r??t)})))}function y(e){let{lazy:t,children:r,selectedValue:n}=e;const l=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===n));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function v(e){const t=h(e);return a.createElement("div",{className:(0,l.Z)("tabs-container",g.tabList)},a.createElement(k,(0,n.Z)({},e,t)),a.createElement(y,(0,n.Z)({},e,t)))}function N(e){const t=(0,b.Z)();return a.createElement(v,(0,n.Z)({key:String(t)},e))}},7171:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>f,frontMatter:()=>i,metadata:()=>u,toc:()=>p});var n=r(7462),a=(r(7294),r(3905)),l=r(4866),s=r(5162);const i={id:"results-file",title:"Results file",sidebar_label:"Results file",slug:"/results-file"},o=void 0,u={unversionedId:"results-file",id:"results-file",title:"Results file",description:"All your test results will be saved in a results file. By default, Betterer sets this to be .betterer.results, but you can change that by using the --results option when running Betterer.",source:"@site/docs/results-file.md",sourceDirName:".",slug:"/results-file",permalink:"/betterer/docs/results-file",draft:!1,editUrl:"https://github.com/phenomnomnominal/betterer/edit/master/website/docs/results-file.md",tags:[],version:"current",lastUpdatedBy:"Craig Spence",lastUpdatedAt:1636753986,formattedLastUpdatedAt:"Nov 12, 2021",frontMatter:{id:"results-file",title:"Results file",sidebar_label:"Results file",slug:"/results-file"},sidebar:"docs",previous:{title:"Tests",permalink:"/betterer/docs/tests"},next:{title:"Filters",permalink:"/betterer/docs/filters"}},c={},p=[{value:"<code>BettererFileTest</code> results",id:"bettererfiletest-results",level:3},{value:"Merge",id:"merge",level:2},{value:"Merge options",id:"merge-options",level:3},{value:"Automerge",id:"automerge",level:3}],m={toc:p},d="wrapper";function f(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"All your test results will be saved in a results file. By default, ",(0,a.kt)("strong",{parentName:"p"},"Betterer")," sets this to be ",(0,a.kt)("inlineCode",{parentName:"p"},".betterer.results"),", but you can change that by using the ",(0,a.kt)("a",{parentName:"p",href:"./running-betterer#start-options"},(0,a.kt)("inlineCode",{parentName:"a"},"--results"))," option when running ",(0,a.kt)("strong",{parentName:"p"},"Betterer"),"."),(0,a.kt)("p",null,"The results file is similar to a ",(0,a.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/en/snapshot-testing"},"Jest Snapshot file"),". It should be ",(0,a.kt)("a",{parentName:"p",href:"./workflow"},"commited along with your code")," and probably shouldn't be ",(0,a.kt)("a",{parentName:"p",href:"./updating-results"},"updated")," manually (although you of course can if you're feeling confident!)."),(0,a.kt)("p",null,"The results file will look something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'// BETTERER RESULTS V2.\nexports[`no hack comments`] = {\n  value: `{\n    "packages/cli/src/cli.ts:1074837834": [\n      [13, 0, 7, "RegExp match", "645651780"]\n    ],\n    "packages/cli/src/init/update-package-json.ts:2842907794": [\n      [34, 4, 7, "RegExp match", "645651780"]\n    ]\n  }`\n};\n')),(0,a.kt)("p",null,"This is a valid JavaScript file, so you can import it and manipulate it if you need to. Each test will have an object that stores its result value, which can be controlled by a tests ",(0,a.kt)("a",{parentName:"p",href:"./betterer.bettererserialiser"},(0,a.kt)("inlineCode",{parentName:"a"},"serialiser"))," and ",(0,a.kt)("a",{parentName:"p",href:"./betterer.bettererprinter"},(0,a.kt)("inlineCode",{parentName:"a"},"printer"))," options."),(0,a.kt)("p",null,"When your tests run, ",(0,a.kt)("strong",{parentName:"p"},"Betterer")," will check to see the result against the expected result in the results file. If the new result is better, the results file will be updated, and that result will be the expected baseline going forward."),(0,a.kt)("h3",{id:"bettererfiletest-results"},(0,a.kt)("a",{parentName:"h3",href:"./betterer.bettererfiletest"},(0,a.kt)("inlineCode",{parentName:"a"},"BettererFileTest"))," results"),(0,a.kt)("p",null,"The above example comes from a ",(0,a.kt)("a",{parentName:"p",href:"./betterer.bettererfiletest"},(0,a.kt)("inlineCode",{parentName:"a"},"BettererFileTest")),", which has some note-worthy details. A ",(0,a.kt)("a",{parentName:"p",href:"./betterer.bettererfiletest"},(0,a.kt)("inlineCode",{parentName:"a"},"BettererFileTest"))," result has the following format:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'exports[testName]: {\n value: `{\n    "relativeFilePath:fileHash": [\n      [issueLine, issueColumn, length, issueMessage, issueHash]\n      // ... more issues\n    ],\n    // ... more files\n }`\n}\n')),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"fileHash")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"issueHash")," are used to track issues as the lines of code in a file change, or as the file moves around in the codebase. This means they change quite often! Check out the ",(0,a.kt)("a",{parentName:"p",href:"./workflow"},"workflow guide")," for suggested ways to handle this with source control.")),(0,a.kt)("h2",{id:"merge"},"Merge"),(0,a.kt)("p",null,"If you are working in a codebase where there is a lot of changes, you may encounter merge conflicts in the results file. It is possible to resolve these manually, but it is much easier to let ",(0,a.kt)("strong",{parentName:"p"},"Betterer")," handle merging for you!"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"merge")," command does a fairly naive merge of the results file."),(0,a.kt)(l.Z,{groupId:"package-manager",defaultValue:"yarn",values:[{label:"Yarn",value:"yarn"},{label:"npm",value:"npm"}],mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"yarn",mdxType:"TabItem"},(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn betterer merge")," to automatically merge the ",(0,a.kt)("strong",{parentName:"p"},"Betterer")," results file.")),(0,a.kt)(s.Z,{value:"npm",mdxType:"TabItem"},(0,a.kt)("p",null,"Run ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run betterer merge")," to automatically merge the ",(0,a.kt)("strong",{parentName:"p"},"Betterer")," results file."))),(0,a.kt)("h3",{id:"merge-options"},"Merge options"),(0,a.kt)("p",null,"You can pass the following options to ",(0,a.kt)("inlineCode",{parentName:"p"},"merge"),":"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Option"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Default"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"-r"),", ",(0,a.kt)("inlineCode",{parentName:"td"},"--results")," ","[value]"),(0,a.kt)("td",{parentName:"tr",align:null},"Path to test results file relative to CWD"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"./.betterer.results"))))),(0,a.kt)("h3",{id:"automerge"},"Automerge"),(0,a.kt)("p",null,"If you don't ever want to have to think about merging the results file, you can enable automatic merging. Run ",(0,a.kt)("a",{parentName:"p",href:"installation"},(0,a.kt)("inlineCode",{parentName:"a"},"betterer init"))," with the ",(0,a.kt)("a",{parentName:"p",href:"./installation#init-options"},(0,a.kt)("inlineCode",{parentName:"a"},"--automerge")),". ",(0,a.kt)("strong",{parentName:"p"},"Betterer")," will update your git configuration to always run ",(0,a.kt)("inlineCode",{parentName:"p"},"betterer merge")," whenever there is a conflict in the results file."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Automerge is still experimental. Please try it out and ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/phenomnomnominal/betterer/issues"},"create issues on Github")," if anything is weird. If something is broken, you can just delete the Betterer merge config from the ",(0,a.kt)("inlineCode",{parentName:"p"},".gitattributes")," file.")))}f.isMDXComponent=!0}}]);